<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campa Cola Warehouse Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .sidebar {
            min-height: 100vh;
            background-color: #e63946;
            color: white;
        }
        .sidebar .nav-link {
            color: white;
        }
        .sidebar .nav-link:hover {
            background-color: #f1faee;
            color: #e63946;
        }
        .sidebar .nav-link.active {
            background-color: #f1faee;
            color: #e63946;
            font-weight: bold;
        }
        .main-content {
            background-color: #f8f9fa;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .product-card {
            transition: transform 0.3s;
        }
        .product-card:hover {
            transform: translateY(-5px);
        }
        .logo {
            font-weight: bold;
            font-size: 1.5rem;
            color: white;
        }
        .logo span {
            color: #f1faee;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar p-0">
                <div class="p-3">
                    <div class="logo text-center mb-4">Campa<span>Warehouse</span></div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" id="dashboard-tab">
                                <i class="bi bi-speedometer2 me-2"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="inventory-tab">
                                <i class="bi bi-box-seam me-2"></i>Inventory
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="transactions-tab">
                                <i class="bi bi-arrow-left-right me-2"></i>Transactions
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="reports-tab">
                                <i class="bi bi-file-earmark-text me-2"></i>Reports
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="operators-tab">
                                <i class="bi bi-people me-2"></i>Operators
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="backup-tab">
                                <i class="bi bi-cloud-arrow-down me-2"></i>Backup/Restore
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 main-content p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 id="page-title">Dashboard</h2>
                    <div class="dropdown">
                        <button class="btn btn-outline-danger dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle me-1"></i> Warehouse Manager
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>Profile</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                        </ul>
                    </div>
                </div>

                <!-- Dashboard Content -->
                <div id="dashboard-content">
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card text-white bg-danger mb-3">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5 class="card-title">Total Products</h5>
                                            <h2 id="total-products" class="mb-0">0</h2>
                                        </div>
                                        <i class="bi bi-box-seam" style="font-size: 2rem;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-white bg-success mb-3">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5 class="card-title">Total Stock</h5>
                                            <h2 id="total-stock" class="mb-0">0</h2>
                                        </div>
                                        <i class="bi bi-boxes" style="font-size: 2rem;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-white bg-primary mb-3">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5 class="card-title">Total Value</h5>
                                            <h2 id="total-value" class="mb-0">â‚¹0</h2>
                                        </div>
                                        <i class="bi bi-currency-rupee" style="font-size: 2rem;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header bg-white">
                                    <h5 class="mb-0">Low Stock Items</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="low-stock-table">
                                            <thead>
                                                <tr>
                                                    <th>Product</th>
                                                    <th>Size</th>
                                                    <th>Stock</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Low stock items will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header bg-white">
                                    <h5 class="mb-0">Recent Transactions</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="recent-transactions">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Product</th>
                                                    <th>Type</th>
                                                    <th>Qty</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Recent transactions will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inventory Content -->
                <div id="inventory-content" class="d-none">
                    <div class="card mb-4">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Product Inventory</h5>
                            <div>
                                <button class="btn btn-sm btn-danger me-2" id="export-inventory">
                                    <i class="bi bi-file-earmark-excel me-1"></i>Export
                                </button>
                                <button class="btn btn-sm btn-danger" id="import-inventory" data-bs-toggle="modal" data-bs-target="#importModal">
                                    <i class="bi bi-file-earmark-arrow-up me-1"></i>Import
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="mb-3 d-flex justify-content-between">
                                <div class="input-group" style="width: 300px;">
                                    <input type="text" class="form-control" placeholder="Search products..." id="inventory-search">
                                    <button class="btn btn-outline-danger" type="button">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                                <button class="btn btn-danger" id="add-product-btn" data-bs-toggle="modal" data-bs-target="#productModal">
                                    <i class="bi bi-plus-circle me-1"></i>Add Product
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover" id="inventory-table">
                                    <thead>
                                        <tr>
                                            <th>Product</th>
                                            <th>Size</th>
                                            <th>Price</th>
                                            <th>Stock</th>
                                            <th>Value</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Inventory items will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transactions Content -->
                <div id="transactions-content" class="d-none">
                    <div class="card mb-4">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Stock Transactions</h5>
                            <div>
                                <button class="btn btn-sm btn-danger me-2" id="export-transactions">
                                    <i class="bi bi-file-earmark-excel me-1"></i>Export
                                </button>
                                <button class="btn btn-sm btn-danger" id="filter-transactions" data-bs-toggle="modal" data-bs-target="#filterModal">
                                    <i class="bi bi-funnel me-1"></i>Filter
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="input-group" style="width: 300px;">
                                    <input type="text" class="form-control" placeholder="Search transactions..." id="transactions-search">
                                    <button class="btn btn-outline-danger" type="button">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover" id="transactions-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Product</th>
                                            <th>Size</th>
                                            <th>Type</th>
                                            <th>Quantity</th>
                                            <th>Operator</th>
                                            <th>Notes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Transactions will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Content -->
                <div id="reports-content" class="d-none">
                    <div class="card mb-4">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">Generate Reports</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="card product-card mb-4">
                                        <div class="card-body text-center">
                                            <i class="bi bi-file-earmark-text text-danger" style="font-size: 2.5rem;"></i>
                                            <h5 class="mt-3">Daily Report</h5>
                                            <p class="text-muted">Generate daily stock movement report</p>
                                            <button class="btn btn-outline-danger" id="daily-report-btn">Generate</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card product-card mb-4">
                                        <div class="card-body text-center">
                                            <i class="bi bi-calendar-week text-danger" style="font-size: 2.5rem;"></i>
                                            <h5 class="mt-3">Weekly Report</h5>
                                            <p class="text-muted">Generate weekly stock summary</p>
                                            <button class="btn btn-outline-danger" id="weekly-report-btn">Generate</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card product-card mb-4">
                                        <div class="card-body text-center">
                                            <i class="bi bi-calendar-month text-danger" style="font-size: 2.5rem;"></i>
                                            <h5 class="mt-3">Monthly Report</h5>
                                            <p class="text-muted">Generate monthly inventory report</p>
                                            <button class="btn btn-outline-danger" id="monthly-report-btn">Generate</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card product-card mb-4">
                                        <div class="card-body text-center">
                                            <i class="bi bi-graph-up text-danger" style="font-size: 2.5rem;"></i>
                                            <h5 class="mt-3">Profit Report</h5>
                                            <p class="text-muted">Calculate profit margins</p>
                                            <button class="btn btn-outline-danger" id="profit-report-btn">Generate</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Operators Content -->
                <div id="operators-content" class="d-none">
                    <div class="card mb-4">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Warehouse Operators</h5>
                            <button class="btn btn-danger" id="add-operator-btn" data-bs-toggle="modal" data-bs-target="#operatorModal">
                                <i class="bi bi-person-plus me-1"></i>Add Operator
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="operators-table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Username</th>
                                            <th>Role</th>
                                            <th>Last Login</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Operators will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Backup/Restore Content -->
                <div id="backup-content" class="d-none">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header bg-white">
                                    <h5 class="mb-0">Backup Data</h5>
                                </div>
                                <div class="card-body text-center">
                                    <i class="bi bi-cloud-arrow-up text-danger" style="font-size: 3rem;"></i>
                                    <h5 class="mt-3">Create Backup</h5>
                                    <p class="text-muted">Save all warehouse data to a file</p>
                                    <button class="btn btn-danger" id="backup-btn">
                                        <i class="bi bi-download me-1"></i>Create Backup
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header bg-white">
                                    <h5 class="mb-0">Restore Data</h5>
                                </div>
                                <div class="card-body text-center">
                                    <i class="bi bi-cloud-arrow-down text-danger" style="font-size: 3rem;"></i>
                                    <h5 class="mt-3">Restore Backup</h5>
                                    <p class="text-muted">Load warehouse data from a backup file</p>
                                    <button class="btn btn-outline-danger" id="restore-btn" data-bs-toggle="modal" data-bs-target="#restoreModal">
                                        <i class="bi bi-upload me-1"></i>Restore Backup
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productModalLabel">Add New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="product-form">
                        <input type="hidden" id="product-id">
                        <div class="mb-3">
                            <label for="product-name" class="form-label">Product Name</label>
                            <input type="text" class="form-control" id="product-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="product-size" class="form-label">Size</label>
                            <select class="form-select" id="product-size" required>
                                <option value="200ml">200ml</option>
                                <option value="500ml">500ml</option>
                                <option value="750ml">750ml</option>
                                <option value="150ml">150ml</option>
                                <option value="125ml">125ml</option>
                                <option value="Can">Can</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="product-price" class="form-label">Price (â‚¹)</label>
                            <input type="number" class="form-control" id="product-price" required>
                        </div>
                        <div class="mb-3">
                            <label for="product-stock" class="form-label">Initial Stock</label>
                            <input type="number" class="form-control" id="product-stock" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="save-product">Save Product</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Adjustment Modal -->
    <div class="modal fade" id="stockModal" tabindex="-1" aria-labelledby="stockModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="stockModalLabel">Adjust Stock</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="stock-form">
                        <input type="hidden" id="adjust-product-id">
                        <div class="mb-3">
                            <label class="form-label">Product</label>
                            <p class="form-control-plaintext" id="adjust-product-name"></p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Current Stock</label>
                            <p class="form-control-plaintext" id="current-stock"></p>
                        </div>
                        <div class="mb-3">
                            <label for="adjustment-type" class="form-label">Adjustment Type</label>
                            <select class="form-select" id="adjustment-type" required>
                                <option value="add">Add Stock</option>
                                <option value="remove">Remove Stock</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="adjustment-qty" class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="adjustment-qty" required>
                        </div>
                        <div class="mb-3">
                            <label for="adjustment-notes" class="form-label">Notes</label>
                            <textarea class="form-control" id="adjustment-notes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="save-adjustment">Save Adjustment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Operator Modal -->
    <div class="modal fade" id="operatorModal" tabindex="-1" aria-labelledby="operatorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="operatorModalLabel">Add Operator</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="operator-form">
                        <input type="hidden" id="operator-id">
                        <div class="mb-3">
                            <label for="operator-name" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="operator-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="operator-username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="operator-username" required>
                        </div>
                        <div class="mb-3">
                            <label for="operator-password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="operator-password" required>
                        </div>
                        <div class="mb-3">
                            <label for="operator-role" class="form-label">Role</label>
                            <select class="form-select" id="operator-role" required>
                                <option value="operator">Operator</option>
                                <option value="manager">Manager</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="save-operator">Save Operator</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal fade" id="importModal" tabindex="-1" aria-labelledby="importModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="importModalLabel">Import Inventory</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        Importing will replace your current inventory data. Make sure to backup first.
                    </div>
                    <div class="mb-3">
                        <label for="import-file" class="form-label">Select Excel File</label>
                        <input class="form-control" type="file" id="import-file" accept=".xlsx,.xls,.csv">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-import">Import</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Restore Modal -->
    <div class="modal fade" id="restoreModal" tabindex="-1" aria-labelledby="restoreModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="restoreModalLabel">Restore Backup</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        This will replace all current data with the backup. This action cannot be undone.
                    </div>
                    <div class="mb-3">
                        <label for="restore-file" class="form-label">Select Backup File</label>
                        <input class="form-control" type="file" id="restore-file" accept=".json">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-restore">Restore</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Modal -->
    <div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="filterModalLabel">Filter Transactions</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="filter-date-from" class="form-label">From Date</label>
                            <input type="date" class="form-control" id="filter-date-from">
                        </div>
                        <div class="col-md-6">
                            <label for="filter-date-to" class="form-label">To Date</label>
                            <input type="date" class="form-control" id="filter-date-to">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="filter-product" class="form-label">Product</label>
                        <select class="form-select" id="filter-product">
                            <option value="">All Products</option>
                            <!-- Product options will be populated here -->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="filter-type" class="form-label">Transaction Type</label>
                        <select class="form-select" id="filter-type">
                            <option value="">All Types</option>
                            <option value="add">Stock Added</option>
                            <option value="remove">Stock Removed</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="apply-filter">Apply Filter</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize data if not exists
            if (!localStorage.getItem('campaWarehouse')) {
                initializeData();
            }
            
            // Load data from local storage
            loadData();
            
            // Set up event listeners
            setupEventListeners();
            
            // Display dashboard by default
            showDashboard();
        });

        // Initialize sample data
        function initializeData() {
            const initialData = {
                products: [
                    { id: 1, name: 'Campa Cola', size: '200ml', price: 220, stock: 100 },
                    { id: 2, name: 'Power Up', size: '200ml', price: 220, stock: 80 },
                    { id: 3, name: 'Orange', size: '200ml', price: 220, stock: 75 },
                    { id: 4, name: 'Campa Soda', size: '500ml', price: 260, stock: 60 },
                    { id: 5, name: 'Campa Cola', size: '500ml', price: 360, stock: 90 },
                    { id: 6, name: 'Orange', size: '500ml', price: 360, stock: 65 },
                    { id: 7, name: 'Gold Boost Tin', size: 'Can', price: 580, stock: 40 },
                    { id: 8, name: 'Berry Kick', size: '200ml', price: 220, stock: 55 },
                    { id: 9, name: 'Lemon', size: '200ml', price: 220, stock: 70 },
                    { id: 10, name: 'Raskik Tetra Mango', size: '125ml', price: 280, stock: 45 },
                    { id: 11, name: 'Raskik Mango', size: '150ml', price: 220, stock: 50 },
                    { id: 12, name: 'Raskik Nimbu Pani', size: '150ml', price: 220, stock: 60 },
                    { id: 13, name: 'Raskik Apple Drink', size: '150ml', price: 220, stock: 40 },
                    { id: 14, name: 'Raskik Mixed Fruit', size: '150ml', price: 220, stock: 35 },
                    { id: 15, name: 'Raskik Glucose', size: '150ml', price: 220, stock: 50 },
                    { id: 16, name: 'Spinner Lemon', size: '150ml', price: 220, stock: 45 },
                    { id: 17, name: 'Spinner Orange', size: '150ml', price: 220, stock: 55 },
                    { id: 18, name: 'Spinner Nitro', size: '150ml', price: 220, stock: 40 },
                    { id: 19, name: 'Independence Water', size: '750ml', price: 150, stock: 120 }
                ],
                transactions: [],
                operators: [
                    { id: 1, name: 'Warehouse Manager', username: 'manager', password: 'manager123', role: 'manager', lastLogin: new Date().toISOString(), status: 'active' },
                    { id: 2, name: 'Operator 1', username: 'operator1', password: 'operator123', role: 'operator', lastLogin: new Date().toISOString(), status: 'active' }
                ],
                settings: {
                    lowStockThreshold: 20
                }
            };
            
            // Add some sample transactions
            const today = new Date();
            const oneWeekAgo = new Date(today);
            oneWeekAgo.setDate(today.getDate() - 7);
            
            for (let i = 0; i < 20; i++) {
                const randomDays = Math.floor(Math.random() * 7);
                const randomDate = new Date(oneWeekAgo);
                randomDate.setDate(oneWeekAgo.getDate() + randomDays);
                
                const randomProduct = initialData.products[Math.floor(Math.random() * initialData.products.length)];
                const randomQty = Math.floor(Math.random() * 50) + 1;
                const randomType = Math.random() > 0.5 ? 'add' : 'remove';
                
                initialData.transactions.push({
                    id: i + 1,
                    productId: randomProduct.id,
                    productName: randomProduct.name,
                    size: randomProduct.size,
                    type: randomType,
                    quantity: randomQty,
                    date: randomDate.toISOString(),
                    operator: 'operator1',
                    notes: randomType === 'add' ? 'New stock received' : 'Order fulfilled'
                });
            }
            
            localStorage.setItem('campaWarehouse', JSON.stringify(initialData));
        }

        // Load data from local storage
        function loadData() {
            const data = JSON.parse(localStorage.getItem('campaWarehouse'));
            return data;
        }

        // Save data to local storage
        function saveData(data) {
            localStorage.setItem('campaWarehouse', JSON.stringify(data));
        }

        // Set up event listeners
        function setupEventListeners() {
            // Navigation tabs
            document.getElementById('dashboard-tab').addEventListener('click', showDashboard);
            document.getElementById('inventory-tab').addEventListener('click', showInventory);
            document.getElementById('transactions-tab').addEventListener('click', showTransactions);
            document.getElementById('reports-tab').addEventListener('click', showReports);
            document.getElementById('operators-tab').addEventListener('click', showOperators);
            document.getElementById('backup-tab').addEventListener('click', showBackup);
            
            // Product form
            document.getElementById('add-product-btn').addEventListener('click', prepareAddProduct);
            document.getElementById('save-product').addEventListener('click', saveProduct);
            
            // Stock adjustment
            document.getElementById('save-adjustment').addEventListener('click', saveStockAdjustment);
            
            // Operator form
            document.getElementById('add-operator-btn').addEventListener('click', prepareAddOperator);
            document.getElementById('save-operator').addEventListener('click', saveOperator);
            
            // Backup/Restore
            document.getElementById('backup-btn').addEventListener('click', createBackup);
            document.getElementById('restore-btn').addEventListener('click', prepareRestore);
            document.getElementById('confirm-restore').addEventListener('click', restoreBackup);
            
            // Import/Export
            document.getElementById('export-inventory').addEventListener('click', exportInventory);
            document.getElementById('confirm-import').addEventListener('click', importInventory);
            document.getElementById('export-transactions').addEventListener('click', exportTransactions);
            
            // Reports
            document.getElementById('daily-report-btn').addEventListener('click', generateDailyReport);
            document.getElementById('weekly-report-btn').addEventListener('click', generateWeeklyReport);
            document.getElementById('monthly-report-btn').addEventListener('click', generateMonthlyReport);
            document.getElementById('profit-report-btn').addEventListener('click', calculateAndDisplayProfit);
            
            // Search functionality
            document.getElementById('inventory-search').addEventListener('input', searchInventory);
            document.getElementById('transactions-search').addEventListener('input', searchTransactions);
            
            // Filter
            document.getElementById('apply-filter').addEventListener('click', applyTransactionFilter);
        }

        // Navigation functions
        function showDashboard() {
            hideAllContent();
            document.getElementById('dashboard-content').classList.remove('d-none');
            document.getElementById('page-title').textContent = 'Dashboard';
            
            // Update active tab
            updateActiveTab('dashboard-tab');
            
            // Load dashboard data
            loadDashboardData();
        }

        function showInventory() {
            hideAllContent();
            document.getElementById('inventory-content').classList.remove('d-none');
            document.getElementById('page-title').textContent = 'Inventory Management';
            
            // Update active tab
            updateActiveTab('inventory-tab');
            
            // Load inventory data
            loadInventoryData();
        }

        function showTransactions() {
            hideAllContent();
            document.getElementById('transactions-content').classList.remove('d-none');
            document.getElementById('page-title').textContent = 'Stock Transactions';
            
            // Update active tab
            updateActiveTab('transactions-tab');
            
            // Load transactions data
            loadTransactionsData();
        }

        function showReports() {
            hideAllContent();
            document.getElementById('reports-content').classList.remove('d-none');
            document.getElementById('page-title').textContent = 'Reports';
            
            // Update active tab
            updateActiveTab('reports-tab');
        }

        function showOperators() {
            hideAllContent();
            document.getElementById('operators-content').classList.remove('d-none');
            document.getElementById('page-title').textContent = 'Operators Management';
            
            // Update active tab
            updateActiveTab('operators-tab');
            
            // Load operators data
            loadOperatorsData();
        }

        function showBackup() {
            hideAllContent();
            document.getElementById('backup-content').classList.remove('d-none');
            document.getElementById('page-title').textContent = 'Backup & Restore';
            
            // Update active tab
            updateActiveTab('backup-tab');
        }

        function hideAllContent() {
            document.getElementById('dashboard-content').classList.add('d-none');
            document.getElementById('inventory-content').classList.add('d-none');
            document.getElementById('transactions-content').classList.add('d-none');
            document.getElementById('reports-content').classList.add('d-none');
            document.getElementById('operators-content').classList.add('d-none');
            document.getElementById('backup-content').classList.add('d-none');
        }

        function updateActiveTab(activeTabId) {
            // Remove active class from all tabs
            document.querySelectorAll('.sidebar .nav-link').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Add active class to current tab
            document.getElementById(activeTabId).classList.add('active');
        }

        // Dashboard functions
        function loadDashboardData() {
            const data = loadData();
            
            // Calculate totals
            const totalProducts = data.products.length;
            const totalStock = data.products.reduce((sum, product) => sum + product.stock, 0);
            const totalValue = data.products.reduce((sum, product) => sum + (product.stock * product.price), 0);
            
            // Update dashboard cards
            document.getElementById('total-products').textContent = totalProducts;
            document.getElementById('total-stock').textContent = totalStock;
            document.getElementById('total-value').textContent = `â‚¹${totalValue.toLocaleString()}`;
            
            // Load low stock items
            loadLowStockItems();
            
            // Load recent transactions
            loadRecentTransactions();
        }

        function loadLowStockItems() {
            const data = loadData();
            const lowStockThreshold = data.settings.lowStockThreshold || 20;
            const lowStockItems = data.products.filter(product => product.stock <= lowStockThreshold);
            
            const tableBody = document.getElementById('low-stock-table').querySelector('tbody');
            tableBody.innerHTML = '';
            
            lowStockItems.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.size}</td>
                    <td class="${item.stock <= 5 ? 'text-danger fw-bold' : ''}">${item.stock}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger adjust-stock-btn" data-id="${item.id}">
                            <i class="bi bi-pencil-square"></i> Adjust
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to adjust buttons
            document.querySelectorAll('.adjust-stock-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    prepareStockAdjustment(productId);
                });
            });
        }

        function loadRecentTransactions() {
            const data = loadData();
            const recentTransactions = [...data.transactions]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            const tableBody = document.getElementById('recent-transactions').querySelector('tbody');
            tableBody.innerHTML = '';
            
            recentTransactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const formattedDate = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${transaction.productName}</td>
                    <td class="${transaction.type === 'add' ? 'text-success' : 'text-danger'}">
                        ${transaction.type === 'add' ? 'Added' : 'Removed'}
                    </td>
                    <td>${transaction.quantity}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Inventory functions
        function loadInventoryData() {
            const data = loadData();
            const tableBody = document.getElementById('inventory-table').querySelector('tbody');
            tableBody.innerHTML = '';
            
            data.products.forEach(product => {
                const value = product.stock * product.price;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.size}</td>
                    <td>â‚¹${product.price}</td>
                    <td>${product.stock}</td>
                    <td>â‚¹${value.toLocaleString()}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1 adjust-stock-btn" data-id="${product.id}">
                            <i class="bi bi-pencil-square"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger delete-product-btn" data-id="${product.id}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to adjust buttons
            document.querySelectorAll('.adjust-stock-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    prepareStockAdjustment(productId);
                });
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-product-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    deleteProduct(productId);
                });
            });
        }

        function prepareAddProduct() {
            const modal = document.getElementById('productModal');
            const form = document.getElementById('product-form');
            
            // Reset form
            form.reset();
            document.getElementById('product-id').value = '';
            document.getElementById('productModalLabel').textContent = 'Add New Product';
        }

        function prepareEditProduct(productId) {
            const data = loadData();
            const product = data.products.find(p => p.id === productId);
            
            if (product) {
                const modal = document.getElementById('productModal');
                const form = document.getElementById('product-form');
                
                // Fill form with product data
                document.getElementById('product-id').value = product.id;
                document.getElementById('product-name').value = product.name;
                document.getElementById('product-size').value = product.size;
                document.getElementById('product-price').value = product.price;
                document.getElementById('product-stock').value = product.stock;
                
                document.getElementById('productModalLabel').textContent = 'Edit Product';
                
                // Show modal
                const bootstrapModal = new bootstrap.Modal(modal);
                bootstrapModal.show();
            }
        }

        function saveProduct() {
            const data = loadData();
            const form = document.getElementById('product-form');
            const productId = document.getElementById('product-id').value;
            
            // Validate form
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }
            
            // Get form values
            const name = document.getElementById('product-name').value;
            const size = document.getElementById('product-size').value;
            const price = parseInt(document.getElementById('product-price').value);
            const stock = parseInt(document.getElementById('product-stock').value);
            
            if (productId) {
                // Edit existing product
                const index = data.products.findIndex(p => p.id === parseInt(productId));
                if (index !== -1) {
                    data.products[index] = {
                        ...data.products[index],
                        name,
                        size,
                        price,
                        stock
                    };
                }
            } else {
                // Add new product
                const newId = data.products.length > 0 ? Math.max(...data.products.map(p => p.id)) + 1 : 1;
                data.products.push({
                    id: newId,
                    name,
                    size,
                    price,
                    stock
                });
                
                // Add initial stock transaction
                const today = new Date().toISOString();
                data.transactions.push({
                    id: data.transactions.length > 0 ? Math.max(...data.transactions.map(t => t.id)) + 1 : 1,
                    productId: newId,
                    productName: name,
                    size,
                    type: 'add',
                    quantity: stock,
                    date: today,
                    operator: 'manager',
                    notes: 'Initial stock'
                });
            }
            
            // Save data
            saveData(data);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('productModal'));
            modal.hide();
            
            // Refresh inventory view
            if (document.getElementById('inventory-content').classList.contains('d-none')) {
                showInventory();
            } else {
                loadInventoryData();
            }
            
            // Refresh dashboard if needed
            loadDashboardData();
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
                const data = loadData();
                data.products = data.products.filter(p => p.id !== productId);
                
                // Also remove related transactions
                data.transactions = data.transactions.filter(t => t.productId !== productId);
                
                saveData(data);
                loadInventoryData();
                loadDashboardData();
            }
        }

        // Stock adjustment functions
        function prepareStockAdjustment(productId) {
            const data = loadData();
            const product = data.products.find(p => p.id === productId);
            
            if (product) {
                const modal = document.getElementById('stockModal');
                const form = document.getElementById('stock-form');
                
                // Fill form with product data
                document.getElementById('adjust-product-id').value = product.id;
                document.getElementById('adjust-product-name').textContent = `${product.name} (${product.size})`;
                document.getElementById('current-stock').textContent = product.stock;
                document.getElementById('adjustment-qty').value = '';
                document.getElementById('adjustment-notes').value = '';
                
                // Show modal
                const bootstrapModal = new bootstrap.Modal(modal);
                bootstrapModal.show();
            }
        }

        function saveStockAdjustment() {
            const data = loadData();
            const form = document.getElementById('stock-form');
            
            // Validate form
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }
            
            // Get form values
            const productId = parseInt(document.getElementById('adjust-product-id').value);
            const type = document.getElementById('adjustment-type').value;
            const quantity = parseInt(document.getElementById('adjustment-qty').value);
            const notes = document.getElementById('adjustment-notes').value;
            
            // Find product
            const productIndex = data.products.findIndex(p => p.id === productId);
            if (productIndex === -1) return;
            
            const product = data.products[productIndex];
            
            // Update stock
            if (type === 'add') {
                product.stock += quantity;
            } else {
                if (quantity > product.stock) {
                    alert('Cannot remove more stock than available!');
                    return;
                }
                product.stock -= quantity;
            }
            
            // Add transaction
            const today = new Date().toISOString();
            data.transactions.push({
                id: data.transactions.length > 0 ? Math.max(...data.transactions.map(t => t.id)) + 1 : 1,
                productId: product.id,
                productName: product.name,
                size: product.size,
                type,
                quantity,
                date: today,
                operator: 'manager',
                notes: notes || (type === 'add' ? 'Stock added' : 'Stock removed')
            });
            
            // Save data
            saveData(data);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('stockModal'));
            modal.hide();
            
            // Refresh views
            loadInventoryData();
            loadDashboardData();
            
            if (!document.getElementById('transactions-content').classList.contains('d-none')) {
                loadTransactionsData();
            }
        }

        // Transactions functions
        function loadTransactionsData(filter = {}) {
            const data = loadData();
            let transactions = [...data.transactions];
            
            // Apply filters if any
            if (filter.dateFrom) {
                const dateFrom = new Date(filter.dateFrom);
                transactions = transactions.filter(t => new Date(t.date) >= dateFrom);
            }
            
            if (filter.dateTo) {
                const dateTo = new Date(filter.dateTo);
                dateTo.setHours(23, 59, 59, 999); // End of day
                transactions = transactions.filter(t => new Date(t.date) <= dateTo);
            }
            
            if (filter.productId) {
                transactions = transactions.filter(t => t.productId === parseInt(filter.productId));
            }
            
            if (filter.type) {
                transactions = transactions.filter(t => t.type === filter.type);
            }
            
            // Sort by date (newest first)
            transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Populate table
            const tableBody = document.getElementById('transactions-table').querySelector('tbody');
            tableBody.innerHTML = '';
            
            transactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${transaction.productName}</td>
                    <td>${transaction.size}</td>
                    <td class="${transaction.type === 'add' ? 'text-success' : 'text-danger'}">
                        ${transaction.type === 'add' ? 'Added' : 'Removed'}
                    </td>
                    <td>${transaction.quantity}</td>
                    <td>${transaction.operator}</td>
                    <td>${transaction.notes || '-'}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function searchInventory() {
            const searchTerm = document.getElementById('inventory-search').value.toLowerCase();
            const rows = document.getElementById('inventory-table').querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const productName = row.cells[0].textContent.toLowerCase();
                const productSize = row.cells[1].textContent.toLowerCase();
                const text = `${productName} ${productSize}`;
                
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function searchTransactions() {
            const searchTerm = document.getElementById('transactions-search').value.toLowerCase();
            const rows = document.getElementById('transactions-table').querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const productName = row.cells[1].textContent.toLowerCase();
                const operator = row.cells[5].textContent.toLowerCase();
                const notes = row.cells[6].textContent.toLowerCase();
                const text = `${productName} ${operator} ${notes}`;
                
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function applyTransactionFilter() {
            const dateFrom = document.getElementById('filter-date-from').value;
            const dateTo = document.getElementById('filter-date-to').value;
            const productId = document.getElementById('filter-product').value;
            const type = document.getElementById('filter-type').value;
            
            const filter = {};
            if (dateFrom) filter.dateFrom = dateFrom;
            if (dateTo) filter.dateTo = dateTo;
            if (productId) filter.productId = parseInt(productId);
            if (type) filter.type = type;
            
            loadTransactionsData(filter);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('filterModal'));
            modal.hide();
        }

        // Operators functions
        function loadOperatorsData() {
            const data = loadData();
            const tableBody = document.getElementById('operators-table').querySelector('tbody');
            tableBody.innerHTML = '';
            
            data.operators.forEach(operator => {
                const lastLogin = new Date(operator.lastLogin);
                const formattedDate = `${lastLogin.getDate().toString().padStart(2, '0')}/${(lastLogin.getMonth() + 1).toString().padStart(2, '0')}/${lastLogin.getFullYear()}`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${operator.name}</td>
                    <td>${operator.username}</td>
                    <td>${operator.role === 'manager' ? 'Manager' : 'Operator'}</td>
                    <td>${formattedDate}</td>
                    <td>
                        <span class="badge ${operator.status === 'active' ? 'bg-success' : 'bg-secondary'}">
                            ${operator.status === 'active' ? 'Active' : 'Inactive'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1 edit-operator-btn" data-id="${operator.id}">
                            <i class="bi bi-pencil-square"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger ${operator.role === 'manager' ? 'disabled' : ''} delete-operator-btn" data-id="${operator.id}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-operator-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const operatorId = parseInt(this.getAttribute('data-id'));
                    prepareEditOperator(operatorId);
                });
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-operator-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!this.classList.contains('disabled')) {
                        const operatorId = parseInt(this.getAttribute('data-id'));
                        deleteOperator(operatorId);
                    }
                });
            });
        }

        function prepareAddOperator() {
            const modal = document.getElementById('operatorModal');
            const form = document.getElementById('operator-form');
            
            // Reset form
            form.reset();
            document.getElementById('operator-id').value = '';
            document.getElementById('operatorModalLabel').textContent = 'Add Operator';
        }

        function prepareEditOperator(operatorId) {
            const data = loadData();
            const operator = data.operators.find(o => o.id === operatorId);
            
            if (operator) {
                const modal = document.getElementById('operatorModal');
                const form = document.getElementById('operator-form');
                
                // Fill form with operator data
                document.getElementById('operator-id').value = operator.id;
                document.getElementById('operator-name').value = operator.name;
                document.getElementById('operator-username').value = operator.username;
                document.getElementById('operator-password').value = operator.password;
                document.getElementById('operator-role').value = operator.role;
                
                document.getElementById('operatorModalLabel').textContent = 'Edit Operator';
                
                // Show modal
                const bootstrapModal = new bootstrap.Modal(modal);
                bootstrapModal.show();
            }
        }

        function saveOperator() {
            const data = loadData();
            const form = document.getElementById('operator-form');
            const operatorId = document.getElementById('operator-id').value;
            
            // Validate form
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }
            
            // Get form values
            const name = document.getElementById('operator-name').value;
            const username = document.getElementById('operator-username').value;
            const password = document.getElementById('operator-password').value;
            const role = document.getElementById('operator-role').value;
            
            // Check if username already exists (for new operators)
            if (!operatorId) {
                const usernameExists = data.operators.some(o => o.username === username);
                if (usernameExists) {
                    alert('Username already exists!');
                    return;
                }
            }
            
            if (operatorId) {
                // Edit existing operator
                const index = data.operators.findIndex(o => o.id === parseInt(operatorId));
                if (index !== -1) {
                    data.operators[index] = {
                        ...data.operators[index],
                        name,
                        username,
                        password,
                        role
                    };
                }
            } else {
                // Add new operator
                const newId = data.operators.length > 0 ? Math.max(...data.operators.map(o => o.id)) + 1 : 1;
                data.operators.push({
                    id: newId,
                    name,
                    username,
                    password,
                    role,
                    lastLogin: new Date().toISOString(),
                    status: 'active'
                });
            }
            
            // Save data
            saveData(data);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('operatorModal'));
            modal.hide();
            
            // Refresh operators view
            loadOperatorsData();
        }

        function deleteOperator(operatorId) {
            if (confirm('Are you sure you want to delete this operator? This action cannot be undone.')) {
                const data = loadData();
                data.operators = data.operators.filter(o => o.id !== operatorId);
                saveData(data);
                loadOperatorsData();
            }
        }

        // Backup/Restore functions
        function createBackup() {
            const data = loadData();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `campa_warehouse_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Backup created successfully!');
        }

        function prepareRestore() {
            // Reset file input
            document.getElementById('restore-file').value = '';
        }

        function restoreBackup() {
            const fileInput = document.getElementById('restore-file');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a backup file first!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Basic validation
                    if (!data.products || !data.transactions || !data.operators) {
                        throw new Error('Invalid backup file format');
                    }
                    
                    // Confirm restore
                    if (confirm('This will replace all current data with the backup. Are you sure?')) {
                        saveData(data);
                        
                        // Close modal
                        const modal = bootstrap.Modal.getInstance(document.getElementById('restoreModal'));
                        modal.hide();
                        
                        // Reload all data
                        loadDashboardData();
                        loadInventoryData();
                        loadTransactionsData();
                        loadOperatorsData();
                        
                        alert('Data restored successfully!');
                    }
                } catch (error) {
                    alert('Error restoring backup: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Import/Export functions
        function exportInventory() {
            const data = loadData();
            
            // Prepare worksheet data
            const wsData = [
                ['Product Name', 'Size', 'Price (â‚¹)', 'Stock', 'Value (â‚¹)'],
                ...data.products.map(p => [p.name, p.size, p.price, p.stock, p.price * p.stock])
            ];
            
            // Create worksheet
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Inventory');
            
            // Export to file
            XLSX.writeFile(wb, `campa_inventory_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        function importInventory() {
            const fileInput = document.getElementById('import-file');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select an Excel file first!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Get first worksheet
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // Validate data
                    if (jsonData.length === 0 || !jsonData[0]['Product Name'] || !jsonData[0]['Size']) {
                        throw new Error('Invalid Excel format. Please use the exported template.');
                    }
                    
                    // Confirm import
                    if (confirm('This will replace your current inventory. Are you sure?')) {
                        const currentData = loadData();
                        
                        // Generate new products array
                        const newProducts = jsonData.map((row, index) => ({
                            id: index + 1,
                            name: row['Product Name'],
                            size: row['Size'],
                            price: row['Price (â‚¹)'] || 0,
                            stock: row['Stock'] || 0
                        }));
                        
                        // Update data
                        currentData.products = newProducts;
                        
                        // Save data
                        saveData(currentData);
                        
                        // Close modal
                        const modal = bootstrap.Modal.getInstance(document.getElementById('importModal'));
                        modal.hide();
                        
                        // Refresh inventory view
                        loadInventoryData();
                        loadDashboardData();
                        
                        alert('Inventory imported successfully!');
                    }
                } catch (error) {
                    alert('Error importing inventory: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function exportTransactions() {
            const data = loadData();
            
            // Prepare worksheet data
            const wsData = [
                ['Date', 'Product Name', 'Size', 'Type', 'Quantity', 'Operator', 'Notes'],
                ...data.transactions.map(t => {
                    const date = new Date(t.date);
                    const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
                    
                    return [
                        formattedDate,
                        t.productName,
                        t.size,
                        t.type === 'add' ? 'Added' : 'Removed',
                        t.quantity,
                        t.operator,
                        t.notes || ''
                    ];
                })
            ];
            
            // Create worksheet
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Transactions');
            
            // Export to file
            XLSX.writeFile(wb, `campa_transactions_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        // Report functions
        function generateDailyReport() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const data = loadData();
            const dailyTransactions = data.transactions.filter(t => {
                const transDate = new Date(t.date);
                return transDate >= today && transDate < tomorrow;
            });
            
            if (dailyTransactions.length === 0) {
                alert('No transactions found for today!');
                return;
            }
            
            // Group by product and type
            const reportData = {};
            dailyTransactions.forEach(t => {
                const key = `${t.productName}|${t.size}|${t.type}`;
                if (!reportData[key]) {
                    reportData[key] = {
                        productName: t.productName,
                        size: t.size,
                        type: t.type,
                        quantity: 0
                    };
                }
                reportData[key].quantity += t.quantity;
            });
            
            // Prepare worksheet data
            const wsData = [
                ['Daily Stock Movement Report', `Date: ${today.toISOString().split('T')[0]}`],
                [''],
                ['Product Name', 'Size', 'Transaction Type', 'Quantity'],
                ...Object.values(reportData).map(r => [
                    r.productName,
                    r.size,
                    r.type === 'add' ? 'Added' : 'Removed',
                    r.quantity
                ])
            ];
            
            // Create worksheet
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Daily Report');
            
            // Export to file
            XLSX.writeFile(wb, `campa_daily_report_${today.toISOString().split('T')[0]}.xlsx`);
        }

        function generateWeeklyReport() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const oneWeekAgo = new Date(today);
            oneWeekAgo.setDate(today.getDate() - 7);
            
            const data = loadData();
            const weeklyTransactions = data.transactions.filter(t => {
                const transDate = new Date(t.date);
                return transDate >= oneWeekAgo && transDate <= today;
            });
            
            if (weeklyTransactions.length === 0) {
                alert('No transactions found for the last week!');
                return;
            }
            
            // Group by product and type
            const reportData = {};
            weeklyTransactions.forEach(t => {
                const key = `${t.productName}|${t.size}|${t.type}`;
                if (!reportData[key]) {
                    reportData[key] = {
                        productName: t.productName,
                        size: t.size,
                        type: t.type,
                        quantity: 0
                    };
                }
                reportData[key].quantity += t.quantity;
            });
            
            // Prepare worksheet data
            const wsData = [
                ['Weekly Stock Movement Report', `From: ${oneWeekAgo.toISOString().split('T')[0]} To: ${today.toISOString().split('T')[0]}`],
                [''],
                ['Product Name', 'Size', 'Transaction Type', 'Quantity'],
                ...Object.values(reportData).map(r => [
                    r.productName,
                    r.size,
                    r.type === 'add' ? 'Added' : 'Removed',
                    r.quantity
                ]),
                [''],
                ['Current Inventory Summary'],
                ['Product Name', 'Size', 'Price (â‚¹)', 'Stock', 'Value (â‚¹)'],
                ...data.products.map(p => [p.name, p.size, p.price, p.stock, p.price * p.stock])
            ];
            
            // Create worksheet
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Weekly Report');
            
            // Export to file
            XLSX.writeFile(wb, `campa_weekly_report_${today.toISOString().split('T')[0]}.xlsx`);
        }

        function generateMonthlyReport() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const oneMonthAgo = new Date(today);
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
            
            const data = loadData();
            const monthlyTransactions = data.transactions.filter(t => {
                const transDate = new Date(t.date);
                return transDate >= oneMonthAgo && transDate <= today;
            });
            
            if (monthlyTransactions.length === 0) {
                alert('No transactions found for the last month!');
                return;
            }
            
            // Group by product and type
            const reportData = {};
            monthlyTransactions.forEach(t => {
                const key = `${t.productName}|${t.size}|${t.type}`;
                if (!reportData[key]) {
                    reportData[key] = {
                        productName: t.productName,
                        size: t.size,
                        type: t.type,
                        quantity: 0
                    };
                }
                reportData[key].quantity += t.quantity;
            });
            
            // Prepare worksheet data
            const wsData = [
                ['Monthly Stock Movement Report', `From: ${oneMonthAgo.toISOString().split('T')[0]} To: ${today.toISOString().split('T')[0]}`],
                [''],
                ['Product Name', 'Size', 'Transaction Type', 'Quantity'],
                ...Object.values(reportData).map(r => [
                    r.productName,
                    r.size,
                    r.type === 'add' ? 'Added' : 'Removed',
                    r.quantity
                ]),
                [''],
                ['Current Inventory Summary'],
                ['Product Name', 'Size', 'Price (â‚¹)', 'Stock', 'Value (â‚¹)'],
                ...data.products.map(p => [p.name, p.size, p.price, p.stock, p.price * p.stock]),
                [''],
                ['Inventory Valuation'],
                ['Total Products', data.products.length],
                ['Total Stock', data.products.reduce((sum, p) => sum + p.stock, 0)],
                ['Total Value (â‚¹)', data.products.reduce((sum, p) => sum + (p.price * p.stock), 0)]
            ];
            
            // Create worksheet
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Monthly Report');
            
            // Export to file
            XLSX.writeFile(wb, `campa_monthly_report_${today.toISOString().split('T')[0]}.xlsx`);
        }

        // Profit calculation functions
        function calculateAndDisplayProfit() {
            const data = loadData();
            
            // Company cost prices
            const costPrices = {
                'Campa Cola 200ml': 198,
                'Power Up 200ml': 198,
                'Orange 200ml': 198,
                'Campa Soda 500ml': 220,
                'Campa Cola 500ml': 320,
                'Orange 500ml': 320,
                'Gold Boost Tin Can': 550,
                'Berry Kick 200ml': 180,
                'Lemon 200ml': 198,
                'Raskik Tetra Mango 125ml': 250,
                'Raskik Mango 150ml': 185,
                'Raskik Nimbu Pani 150ml': 185,
                'Raskik Apple Drink 150ml': 185,
                'Raskik Mixed Fruit 150ml': 185,
                'Raskik Glucose 150ml': 185,
                'Spinner Lemon 150ml': 185,
                'Spinner Orange 150ml': 185,
                'Spinner Nitro 150ml': 185,
                'Independence Water 750ml': 128
            };

            // Calculate profit for each product
            const profitData = data.products.map(product => {
                const key = `${product.name} ${product.size}`;
                const costPrice = costPrices[key] || 0;
                const profitPerUnit = product.price - costPrice;
                const totalProfit = profitPerUnit * product.stock;
                const profitMargin = (profitPerUnit / product.price) * 100;
                
                return {
                    name: product.name,
                    size: product.size,
                    sellingPrice: product.price,
                    costPrice: costPrice,
                    stock: product.stock,
                    profitPerUnit: profitPerUnit,
                    totalProfit: totalProfit,
                    profitMargin: profitMargin
                };
            });

            // Sort by total profit (descending)
            profitData.sort((a, b) => b.totalProfit - a.totalProfit);

            // Calculate totals
            const totalPotentialProfit = profitData.reduce((sum, product) => sum + product.totalProfit, 0);
            const totalInventoryValue = profitData.reduce((sum, product) => sum + (product.sellingPrice * product.stock), 0);

            // Create a modal to display the profit report
            const modalHTML = `
            <div class="modal fade" id="profitModal" tabindex="-1" aria-labelledby="profitModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="profitModalLabel">Profit Analysis Report</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-info mb-4">
                                <h5>Summary</h5>
                                <p><strong>Total Potential Profit:</strong> â‚¹${totalPotentialProfit.toLocaleString()}</p>
                                <p><strong>Total Inventory Value:</strong> â‚¹${totalInventoryValue.toLocaleString()}</p>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Product</th>
                                            <th>Size</th>
                                            <th>Selling Price</th>
                                            <th>Cost Price</th>
                                            <th>Profit/Unit</th>
                                            <th>Stock</th>
                                            <th>Total Profit</th>
                                            <th>Margin</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${profitData.map(product => `
                                            <tr>
                                                <td>${product.name}</td>
                                                <td>${product.size}</td>
                                                <td>â‚¹${product.sellingPrice}</td>
                                                <td>â‚¹${product.costPrice}</td>
                                                <td class="${product.profitPerUnit > 0 ? 'text-success' : 'text-danger'}">
                                                    â‚¹${product.profitPerUnit}
                                                </td>
                                                <td>${product.stock}</td>
                                                <td>â‚¹${product.totalProfit}</td>
                                                <td>${product.profitMargin.toFixed(1)}%</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-danger" id="export-profit-report">
                                <i class="bi bi-file-earmark-excel me-1"></i>Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            `;

            // Add modal to DOM
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Show modal
            const profitModal = new bootstrap.Modal(document.getElementById('profitModal'));
            profitModal.show();

            // Add event listener for export button
            document.getElementById('export-profit-report')?.addEventListener('click', () => {
                exportProfitReport(profitData, totalPotentialProfit, totalInventoryValue);
            });

            // Remove modal when closed
            document.getElementById('profitModal')?.addEventListener('hidden.bs.modal', () => {
                document.getElementById('profitModal')?.remove();
            });
        }

        function exportProfitReport(profitData, totalProfit, totalValue) {
            // Prepare worksheet data
            const wsData = [
                ['Profit Analysis Report', `Generated: ${new Date().toISOString().split('T')[0]}`],
                [''],
                ['Total Potential Profit', `â‚¹${totalProfit}`],
                ['Total Inventory Value', `â‚¹${totalValue}`],
                [''],
                ['Product', 'Size', 'Selling Price (â‚¹)', 'Cost Price (â‚¹)', 'Profit/Unit (â‚¹)', 'Stock', 'Total Profit (â‚¹)', 'Margin (%)'],
                ...profitData.map(p => [
                    p.name,
                    p.size,
                    p.sellingPrice,
                    p.costPrice,
                    p.profitPerUnit,
                    p.stock,
                    p.totalProfit,
                    p.profitMargin.toFixed(1)
                ])
            ];
            
            // Create worksheet
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Profit Report');
            
            // Export to file
            XLSX.writeFile(wb, `campa_profit_report_${new Date().toISOString().split('T')[0]}.xlsx`);
        }
    </script>
</body>
</html>
